
function Tiler(){
	devices = {
		"id4501": {
		  "id": 4501,
		  "name": "ElectronPot",
		  "description": "Making Electricity out of plants",
		  "owner_id": 6453,
		  "owner_username": "BioPhotoVoltaics",
		  "latitude": 41.3968195014,
		  "longitude": 2.1943259239196,
		  "city": "Barcelona",
		  "country_code": "ES",
		  "kit_id": 22,
		  "state": "has_published",
		  "system_tags": [
			"offline",
			"outdoor"
		  ],
		  "user_tags": [
			"Research"
		  ],
		  "added_at": "2018-03-26T16:42:10Z",
		  "updated_at": "2018-06-07T11:03:47Z",
		  "last_reading_at": "2019-02-06T10:54:15Z"
		},
		"id5619": {
		  "id": 5619,
		  "name": "ElectronPot #3",
		  "description": null,
		  "owner_id": 6453,
		  "owner_username": "BioPhotoVoltaics",
		  "latitude": 41.396867,
		  "longitude": 2.194351,
		  "city": "Barcelona",
		  "country_code": "ES",
		  "kit_id": 22,
		  "state": "has_published",
		  "system_tags": [
			"indoor",
			"offline"
		  ],
		  "user_tags": [],
		  "added_at": "2019-02-11T17:17:48Z",
		  "updated_at": "2019-03-01T03:00:28Z",
		  "last_reading_at": "2019-03-01T09:41:21Z"
		},
		"id5616": {
		  "id": 5616,
		  "name": "ElectronPot #2",
		  "description": null,
		  "owner_id": 6453,
		  "owner_username": "BioPhotoVoltaics",
		  "latitude": 41.396867,
		  "longitude": 2.194351,
		  "city": "Barcelona",
		  "country_code": "ES",
		  "kit_id": 22,
		  "state": "has_published",
		  "system_tags": [
			"indoor",
			"online"
		  ],
		  "user_tags": [],
		  "added_at": "2019-02-11T16:58:45Z",
		  "updated_at": "2019-03-06T03:00:51Z",
		  "last_reading_at": "2019-03-06T20:57:16Z"
		}
	};

	readings = {
		"device_id": 5611,
		"sensor_key": "light",
		"sensor_id": 14,
		"component_id": 144,
		"rollup": "4h",
		"function": "avg",
		"from": "2018-08-28T00:00:00Z",
		"to": "2019-07-30T00:00:00Z",
		"sample_size": 20726,
		"readings": [
		  [
			"2019-03-07T20:00:03Z",
			0
		  ],
		  [
			"2019-03-07T16:00:02Z",
			144.63602150537628
		  ],
		  [
			"2019-03-07T12:18:02Z",
			825.8168918918923
		  ],
		  [
			"2019-03-07T08:20:02Z",
			1186.2106666666666
		  ],
		  [
			"2019-03-07T04:05:01Z",
			15.061935483870966
		  ],
		  [
			"2019-03-07T00:00:02Z",
			0
		  ],
		  [
			"2019-03-06T20:00:02Z",
			0.004744186046511628
		  ],
		  [
			"2019-03-06T16:00:02Z",
			235.8717511520733
		  ],
		  [
			"2019-03-06T12:00:02Z",
			763.4792129629631
		  ],
		  [
			"2019-03-06T08:00:02Z",
			392.07368663594474
		  ],
		  [
			"2019-03-06T04:09:01Z",
			18.15768292682927
		  ],
		  [
			"2019-03-06T00:00:06Z",
			0
		  ],
		  [
			"2019-03-05T20:07:06Z",
			0
		  ],
		  [
			"2019-03-05T16:02:04Z",
			154.19034482758622
		  ],
		  [
			"2019-03-05T12:08:03Z",
			1646.0240000000001
		  ],
		  [
			"2019-03-05T08:00:03Z",
			1044.7967889908255
		  ],
		  [
			"2019-03-05T04:13:01Z",
			51.80274285714285
		  ],
		  [
			"2019-03-05T00:01:05Z",
			0
		  ],
		  [
			"2019-03-04T20:01:03Z",
			0
		  ],
		  [
			"2019-03-04T16:20:02Z",
			267.63756097560963
		  ],
		  [
			"2019-03-04T12:00:02Z",
			740.7167320261437
		  ],
		  [
			"2019-03-04T08:02:02Z",
			628.3638888888889
		  ],
		  [
			"2019-03-04T04:00:01Z",
			1.8998809523809523
		  ],
		  [
			"2019-03-04T00:00:05Z",
			0
		  ],
		  [
			"2019-03-03T20:00:03Z",
			0
		  ],
		  [
			"2019-03-03T16:08:03Z",
			4.8623076923076916
		  ],
		  [
			"2019-03-03T12:12:01Z",
			112.29161290322581
		  ],
		  [
			"2019-03-03T08:01:01Z",
			122.17572580645158
		  ],
		  [
			"2019-03-03T04:10:01Z",
			1.5374820143884893
		  ],
		  [
			"2019-03-03T00:17:06Z",
			0
		  ],
		  [
			"2019-03-02T20:00:06Z",
			48.75408602150539
		  ],
		  [
			"2019-03-02T16:00:05Z",
			16.78018867924528
		  ],
		  [
			"2019-03-02T12:04:02Z",
			627.7528571428572
		  ],
		  [
			"2019-03-02T08:00:01Z",
			438.751145038168
		  ],
		  [
			"2019-03-02T04:00:01Z",
			7.416300578034682
		  ],
		  [
			"2019-03-02T00:05:06Z",
			0
		  ],
		  [
			"2019-03-01T20:00:05Z",
			0
		  ],
		  [
			"2019-03-01T16:02:04Z",
			56.425230769230765
		  ],
		  [
			"2019-03-01T12:00:02Z",
			521.853432835821
		  ],
		  [
			"2019-03-01T08:09:02Z",
			396.0667415730337
		  ],
		  [
			"2019-03-01T04:01:01Z",
			7.923387096774194
		  ],
		  [
			"2019-03-01T00:00:48Z",
			0
		  ],
		  [
			"2019-02-28T20:00:47Z",
			0
		  ],
		  [
			"2019-02-28T16:04:03Z",
			145.16931034482758
		  ],
		  [
			"2019-02-28T12:20:01Z",
			523.8315384615385
		  ],
		  [
			"2019-02-28T08:01:01Z",
			155.407
		  ],
		  [
			"2019-02-28T04:00:01Z",
			13.319696969696968
		  ],
		  [
			"2019-02-28T00:20:05Z",
			0
		  ],
		  [
			"2019-02-27T20:06:05Z",
			0
		  ],
		  [
			"2019-02-27T16:09:04Z",
			271.728125
		  ],
		  [
			"2019-02-27T12:02:02Z",
			1699.9472000000003
		  ],
		  [
			"2019-02-27T08:04:02Z",
			1331.8056799999997
		  ],
		  [
			"2019-02-27T04:00:01Z",
			4.894054054054053
		  ],
		  [
			"2019-02-27T00:04:05Z",
			0
		  ],
		  [
			"2019-02-26T20:00:04Z",
			21.082100840336135
		  ],
		  [
			"2019-02-26T16:00:04Z",
			267.09879120879117
		  ],
		  [
			"2019-02-26T12:00:03Z",
			2327.2163265306126
		  ],
		  [
			"2019-02-26T08:00:02Z",
			1086.792011494253
		  ],
		  [
			"2019-02-26T04:00:01Z",
			24.747110091743117
		  ],
		  [
			"2019-02-26T00:00:59Z",
			0
		  ],
		  [
			"2019-02-25T20:00:58Z",
			0
		  ],
		  [
			"2019-02-25T16:00:57Z",
			51.75987341772151
		  ],
		  [
			"2019-02-25T12:01:03Z",
			644.6652830188677
		  ],
		  [
			"2019-02-25T08:02:01Z",
			1163.0226315789478
		  ],
		  [
			"2019-02-25T04:02:01Z",
			15.957333333333334
		  ],
		  [
			"2019-02-25T00:17:03Z",
			0
		  ],
		  [
			"2019-02-24T20:00:02Z",
			0
		  ],
		  [
			"2019-02-24T16:00:01Z",
			50.574485981308385
		  ],
		  [
			"2019-02-24T12:04:01Z",
			1595.0717801047122
		  ],
		  [
			"2019-02-24T08:00:01Z",
			796.6016129032256
		  ],
		  [
			"2019-02-24T04:01:01Z",
			57.68825396825397
		  ],
		  [
			"2019-02-24T00:00:04Z",
			0
		  ],
		  [
			"2019-02-23T20:00:03Z",
			0
		  ],
		  [
			"2019-02-23T16:00:03Z",
			23.820281690140845
		  ],
		  [
			"2019-02-23T12:01:03Z",
			1781.6307834101408
		  ],
		  [
			"2019-02-23T08:00:01Z",
			1108.0681651376146
		  ],
		  [
			"2019-02-23T04:11:01Z",
			24.533725490196087
		  ],
		  [
			"2019-02-23T00:04:04Z",
			0
		  ],
		  [
			"2019-02-22T20:04:04Z",
			26.139
		  ],
		  [
			"2019-02-22T16:00:02Z",
			167.7972499999999
		  ],
		  [
			"2019-02-22T12:00:02Z",
			1959.3360344827595
		  ],
		  [
			"2019-02-22T08:00:02Z",
			675.6904265402842
		  ],
		  [
			"2019-02-22T04:07:02Z",
			4.986602870813397
		  ],
		  [
			"2019-02-22T00:07:25Z",
			0
		  ],
		  [
			"2019-02-21T20:02:24Z",
			0
		  ],
		  [
			"2019-02-21T16:00:02Z",
			212.2676315789473
		  ],
		  [
			"2019-02-21T12:00:02Z",
			825.6878440366974
		  ],
		  [
			"2019-02-21T08:27:02Z",
			636.3106060606062
		  ],
		  [
			"2019-02-21T04:20:02Z",
			2.5928571428571425
		  ],
		  [
			"2019-02-21T00:04:03Z",
			0
		  ],
		  [
			"2019-02-20T20:00:03Z",
			202.64767857142883
		  ],
		  [
			"2019-02-20T16:00:03Z",
			388.9056034482768
		  ],
		  [
			"2019-02-20T12:03:02Z",
			604.8065740740741
		  ],
		  [
			"2019-02-20T08:06:02Z",
			721.8885714285715
		  ],
		  [
			"2019-02-20T04:27:01Z",
			3.27275
		  ],
		  [
			"2019-02-20T00:10:07Z",
			0
		  ],
		  [
			"2019-02-19T20:04:07Z",
			0
		  ],
		  [
			"2019-02-19T16:03:05Z",
			304.6062962962962
		  ],
		  [
			"2019-02-19T12:04:02Z",
			998.8672727272728
		  ],
		  [
			"2019-02-19T08:00:01Z",
			893.1157142857139
		  ],
		  [
			"2019-02-19T04:00:01Z",
			19.91835616438356
		  ],
		  [
			"2019-02-19T00:00:01Z",
			0
		  ],
		  [
			"2019-02-18T20:03:01Z",
			148.20292207792215
		  ],
		  [
			"2019-02-18T16:04:01Z",
			429.9092592592591
		  ],
		  [
			"2019-02-18T12:10:01Z",
			667.8103846153846
		  ],
		  [
			"2019-02-18T08:01:01Z",
			481.311004784689
		  ],
		  [
			"2019-02-18T04:18:01Z",
			3.2552
		  ],
		  [
			"2019-02-18T00:00:04Z",
			0
		  ],
		  [
			"2019-02-17T20:00:04Z",
			0
		  ],
		  [
			"2019-02-17T16:01:04Z",
			333.00691891891915
		  ],
		  [
			"2019-02-17T12:00:04Z",
			644.2800460829494
		  ],
		  [
			"2019-02-17T08:00:02Z",
			451.41451162790713
		  ],
		  [
			"2019-02-17T04:01:01Z",
			29.03129411764706
		  ],
		  [
			"2019-02-17T00:19:04Z",
			0
		  ],
		  [
			"2019-02-16T20:03:03Z",
			341.4744444444444
		  ],
		  [
			"2019-02-16T16:03:02Z",
			52.25322580645161
		  ],
		  [
			"2019-02-16T12:00:02Z",
			218.72153846153844
		  ],
		  [
			"2019-02-16T08:05:02Z",
			139.89629032258065
		  ],
		  [
			"2019-02-16T04:06:01Z",
			1.004
		  ],
		  [
			"2019-02-16T00:00:11Z",
			0
		  ],
		  [
			"2019-02-15T20:06:09Z",
			0.0058620689655172415
		  ],
		  [
			"2019-02-15T16:00:08Z",
			124.72555555555556
		  ],
		  [
			"2019-02-15T12:00:08Z",
			1057.1569124423963
		  ],
		  [
			"2019-02-15T08:00:07Z",
			869.6532227488156
		  ],
		  [
			"2019-02-15T07:32:07Z",
			73.4176923076923
		  ],
		  [
			"2019-02-14T20:00:05Z",
			0.2570731707317075
		  ],
		  [
			"2019-02-14T16:00:02Z",
			394.1307009345798
		  ],
		  [
			"2019-02-14T12:01:01Z",
			994.9732926829272
		  ],
		  [
			"2019-02-14T08:00:01Z",
			502.71185393258423
		  ],
		  [
			"2019-02-14T04:02:01Z",
			3.486029411764706
		  ],
		  [
			"2019-02-14T00:00:02Z",
			0
		  ],
		  [
			"2019-02-13T20:00:02Z",
			286.9672388059699
		  ],
		  [
			"2019-02-13T16:03:02Z",
			423.64258064516156
		  ],
		  [
			"2019-02-13T12:03:02Z",
			835.547804878049
		  ],
		  [
			"2019-02-13T08:27:01Z",
			703.8676666666668
		  ],
		  [
			"2019-02-13T04:00:01Z",
			0.45725
		  ],
		  [
			"2019-02-13T00:00:05Z",
			0
		  ],
		  [
			"2019-02-12T20:00:04Z",
			225.4749537037038
		  ],
		  [
			"2019-02-12T16:01:02Z",
			394.534065420561
		  ],
		  [
			"2019-02-12T12:00:02Z",
			674.0221495327096
		  ],
		  [
			"2019-02-12T08:00:02Z",
			578.9479342723004
		  ],
		  [
			"2019-02-12T04:00:01Z",
			7.619054054054053
		  ],
		  [
			"2019-02-12T00:00:02Z",
			0
		  ],
		  [
			"2019-02-11T20:05:02Z",
			94.14862068965519
		  ],
		  [
			"2019-02-11T16:04:02Z",
			395.2503296703299
		  ],
		  [
			"2019-02-11T12:01:02Z",
			1030.8353594771243
		  ],
		  [
			"2019-02-11T08:00:01Z",
			858.6156744186051
		  ],
		  [
			"2019-02-11T04:02:01Z",
			11.865607476635516
		  ],
		  [
			"2019-02-11T00:12:01Z",
			0
		  ],
		  [
			"2019-02-10T20:00:01Z",
			0
		  ],
		  [
			"2019-02-10T16:00:01Z",
			23.83272727272728
		  ],
		  [
			"2019-02-10T12:10:01Z",
			889.6592178770957
		  ],
		  [
			"2019-02-10T08:01:01Z",
			104.98461538461538
		  ],
		  [
			"2019-02-10T04:00:01Z",
			0.16846590909090908
		  ],
		  [
			"2019-02-10T00:01:05Z",
			0
		  ],
		  [
			"2019-02-09T20:00:05Z",
			0
		  ],
		  [
			"2019-02-09T16:00:03Z",
			16.126901408450703
		  ],
		  [
			"2019-02-09T12:00:02Z",
			387.56221719457005
		  ],
		  [
			"2019-02-09T08:00:02Z",
			463.76745370370344
		  ],
		  [
			"2019-02-09T04:00:01Z",
			2.1849302325581395
		  ],
		  [
			"2019-02-09T00:00:04Z",
			0
		  ],
		  [
			"2019-02-08T20:03:04Z",
			0
		  ],
		  [
			"2019-02-08T16:04:03Z",
			345.44230769230774
		  ],
		  [
			"2019-02-08T12:00:02Z",
			463.16554140127374
		  ],
		  [
			"2019-02-08T08:00:02Z",
			259.9632110091745
		  ],
		  [
			"2019-02-08T04:00:01Z",
			0.4733644859813085
		  ],
		  [
			"2019-02-08T00:00:26Z",
			0
		  ],
		  [
			"2019-02-07T20:00:26Z",
			217.04869158878498
		  ],
		  [
			"2019-02-07T16:01:26Z",
			387.9956279069774
		  ],
		  [
			"2019-02-07T13:56:25Z",
			856.691791044776
		  ]
		]
	  };

	sensor = {
		"id": 5611,
		"uuid": "c445f0b0-b8c5-4394-a285-c54f3c067209",
		"name": "KWMCTheFactory1",
		"description": "iSCAPE Citizen Kit",
		"state": "has_published",
		"hardware_info": {
		  "id": "7A2A3192504E4B4B372E314AFF032127",
		  "mac": "86:F3:EB:8E:45:26",
		  "time": "2019-03-07T03:00:01Z",
		  "esp_bd": "2018-12-18T19:16:42Z",
		  "hw_ver": "2.0",
		  "sam_bd": "2018-12-18T19:16:19Z",
		  "esp_ver": "0.5.0-de8983c",
		  "sam_ver": "0.5.0-de8983c"
		},
		"system_tags": [
		  "online",
		  "outdoor"
		],
		"user_tags": [
		  "MakingSense",
		  "Inside",
		  "Commercial",
		  "iSCAPE",
		  "Lab"
		],
		"notify_low_battery": false,
		"notify_stopped_publishing": false,
		"last_reading_at": "2019-03-07T22:22:03Z",
		"added_at": "2019-02-07T13:56:10Z",
		"updated_at": "2019-03-07T03:01:29Z",
		"mac_address": "[FILTERED]",
		"owner": {
		  "id": 6851,
		  "uuid": "c3049aeb-7deb-409f-b075-5be6b64a21ff",
		  "username": "techkwmc",
		  "avatar": "https://smartcitizen.s3.amazonaws.com/avatars/default.svg",
		  "url": null,
		  "joined_at": "2019-02-07T12:44:04Z",
		  "location": {
			"city": null,
			"country": null,
			"country_code": null
		  },
		  "device_ids": []
		},
		"data": {
		  "recorded_at": "2019-03-07T22:22:03Z",
		  "added_at": "2019-03-07T22:22:03Z",
		  "location": {
			"ip": null,
			"exposure": "outdoor",
			"elevation": null,
			"latitude": 51.420026,
			"longitude": -2.58495300000004,
			"geohash": "gcnht0txq5",
			"city": "Bristol",
			"country_code": "GB",
			"country": "United Kingdom of Great Britain and Northern Ireland"
		  },
		  "sensors": [
			{
			  "id": 14,
			  "ancestry": null,
			  "name": "BH1730FVC",
			  "description": "Digital Ambient Light Sensor",
			  "unit": "Lux",
			  "created_at": "2015-02-02T18:24:56Z",
			  "updated_at": "2015-07-05T19:57:36Z",
			  "measurement_id": 3,
			  "uuid": "ac4234cf-d2b7-4cfa-8765-9f4477e2de5f",
			  "value": 0,
			  "raw_value": 0,
			  "prev_value": 0,
			  "prev_raw_value": 0
			},
			{
			  "id": 10,
			  "ancestry": null,
			  "name": "Battery SCK 1.1",
			  "description": "Custom Circuit",
			  "unit": "%",
			  "created_at": "2015-02-02T18:18:00Z",
			  "updated_at": "2015-07-05T19:53:51Z",
			  "measurement_id": 7,
			  "uuid": "c9ff2784-53a7-4a84-b0fc-90ecc7e313f9",
			  "value": 100,
			  "raw_value": 100,
			  "prev_value": 100,
			  "prev_raw_value": 100
			},
			{
			  "id": 53,
			  "ancestry": "52",
			  "name": "ICS43432 - Noise",
			  "description": "I2S Digital Mems Microphone with custom Audio Processing Algorithm",
			  "unit": "dBA",
			  "created_at": "2018-05-03T10:42:47Z",
			  "updated_at": "2018-05-03T10:42:54Z",
			  "measurement_id": 4,
			  "uuid": "f508548e-3fd1-44aa-839b-9bd147168481",
			  "value": 48.07,
			  "raw_value": 48.07,
			  "prev_value": 47.26,
			  "prev_raw_value": 47.26
			},
			{
			  "id": 58,
			  "ancestry": "57",
			  "name": "MPL3115A2 - Barometric Pressure",
			  "description": "Digital Barometric Pressure Sensor",
			  "unit": "K Pa",
			  "created_at": "2018-05-03T10:49:17Z",
			  "updated_at": "2018-05-03T10:49:17Z",
			  "measurement_id": 25,
			  "uuid": "cadd2459-6559-4d92-aed1-ba04c557fed8",
			  "value": 99.93,
			  "raw_value": 99.93,
			  "prev_value": 99.92,
			  "prev_raw_value": 99.92
			},
			{
			  "id": 16,
			  "ancestry": "20",
			  "name": "MiCS-4514-CO",
			  "description": "CO",
			  "unit": "kOhm",
			  "created_at": "2015-02-02T18:26:11Z",
			  "updated_at": "2015-07-05T19:58:18Z",
			  "measurement_id": 5,
			  "uuid": "49a26be4-3ce1-4f2e-a09b-4296fefcfe17",
			  "value": null,
			  "raw_value": null,
			  "prev_value": null,
			  "prev_raw_value": null
			},
			{
			  "id": 15,
			  "ancestry": "20",
			  "name": "MiCS-4514-NO2",
			  "description": "NO2",
			  "unit": "kOhm",
			  "created_at": "2015-02-02T18:25:51Z",
			  "updated_at": "2015-07-05T19:57:59Z",
			  "measurement_id": 6,
			  "uuid": "0c5b7e74-ef87-431d-89af-dd51de84b10e",
			  "value": null,
			  "raw_value": null,
			  "prev_value": null,
			  "prev_raw_value": null
			},
			{
			  "id": 89,
			  "ancestry": "86",
			  "name": "PMS5003_AVG-PM1",
			  "description": "Particle Matter PM 1",
			  "unit": "ug/m3",
			  "created_at": "2018-05-22T13:20:34Z",
			  "updated_at": "2018-05-22T13:20:34Z",
			  "measurement_id": 27,
			  "uuid": "a4b9efba-241f-446e-9cf2-918f25efd0c5",
			  "value": 2,
			  "raw_value": 2,
			  "prev_value": 2,
			  "prev_raw_value": 2
			},
			{
			  "id": 88,
			  "ancestry": "86",
			  "name": "PMS5003_AVG-PM10",
			  "description": "Particle Matter PM 10",
			  "unit": "ug/m3",
			  "created_at": "2018-05-22T13:20:34Z",
			  "updated_at": "2018-05-22T13:20:34Z",
			  "measurement_id": 13,
			  "uuid": "c2072a22-4d81-4d7c-a38c-af9458b8f309",
			  "value": 3,
			  "raw_value": 3,
			  "prev_value": 3,
			  "prev_raw_value": 3
			},
			{
			  "id": 87,
			  "ancestry": "86",
			  "name": "PMS5003_AVG-PM2.5",
			  "description": "Particle Matter PM 2.5",
			  "unit": "ug/m3",
			  "created_at": "2018-05-22T13:20:34Z",
			  "updated_at": "2018-05-22T13:20:34Z",
			  "measurement_id": 14,
			  "uuid": "9ee89ac2-0482-46dd-905f-0b7a1bb12c55",
			  "value": 3,
			  "raw_value": 3,
			  "prev_value": 3,
			  "prev_raw_value": 3
			},
			{
			  "id": 56,
			  "ancestry": "54",
			  "name": "SHT31 - Humidity",
			  "description": "Humidity",
			  "unit": "%",
			  "created_at": "2018-05-03T10:47:17Z",
			  "updated_at": "2018-05-03T10:47:17Z",
			  "measurement_id": 2,
			  "uuid": "b6543356-0066-4bea-8ad2-687e282f9c20",
			  "value": 28.52,
			  "raw_value": 28.52,
			  "prev_value": 28.68,
			  "prev_raw_value": 28.68
			},
			{
			  "id": 55,
			  "ancestry": "54",
			  "name": "SHT31 - Temperature",
			  "description": "Temperature",
			  "unit": "ºC",
			  "created_at": "2018-05-03T10:47:15Z",
			  "updated_at": "2018-05-03T10:47:15Z",
			  "measurement_id": 1,
			  "uuid": "384e46a2-80dd-481e-a9fc-cfbd512f9f43",
			  "value": 24.59,
			  "raw_value": 24.59,
			  "prev_value": 24.52,
			  "prev_raw_value": 24.52
			}
		  ]
		},
		"kit": {
		  "id": 20,
		  "uuid": "3e5f95f0-fdcc-4de7-b074-cb47fbbd3ceb",
		  "slug": "sck:2,0,1",
		  "name": "iSCAPE Citizen Kit",
		  "description": "iSCAPE Citizen Kit ",
		  "created_at": "2018-05-23T08:18:52Z",
		  "updated_at": "2018-05-23T08:18:52Z"
		}
	  };

	mapData = [];
	for (i = 0; i < 64; i++) {
		mapData.push(1);
	}
	mapSize = Math.floor(Math.sqrt(mapData.length));
	$map = $('table tbody');
	mapPossition = {};
	$tileTemplate = $('body>.tile').remove();

	this.saveDevices();
	// this.onDevice(devices["id4501"]);

	$('.kits').empty();
	Object.keys(devices).forEach( key =>{
		new SmartGardener().onDevice(devices[key]);
	});

	//this.onMessage(sensor);
}

Tiler.prototype.onDevice = function (device) {

	devices["id" + device.id] = device;
	console.log(device);
	new SmartGardener().getDevice(device, deviceData => {
		deviceData.data.sensors.forEach((sensor, index) => {
			var sc = new SmartGardener().getReadings(device, sensor, (readings) => {
				console.log(readings);
				var spiral = new Spiral("#sensor" + index, sensor, readings);
			})
		})
	})
}

Tiler.prototype.saveDevices = function () {

	Object.keys(devices).forEach((device, index) => {
		mapData[index] = 9;
		console.log(index * mapSize, 0, 4, mapData.length, mapSize, mapSize * index);
	});

}

Tiler.prototype.onMessage = function (device){
	console.log(device);
};

var TILER = new Tiler();

function getRow(y){
	if($map.find('.row-'+y).length > 0){
		return $map.find('.row-'+y);
	}
	else{
		return createRow(y);
	}
}

function createRow(y){
	return $('<tr>').addClass('row-'+y).css({
		transform: 'translateY('+(y*4)+'em)'
	}).appendTo($map);
}

function getCol(y,x){
	var $row = getRow(y);
	if($row.find('.col-'+x).length > 0){
		return $row.find('.col-'+x);
	}
	else{
		return createCol(y,x);
	}
}

function createCol(y,x){
	var $row = getRow(y);
	return $('<td>').addClass('col-'+x).css({
		transform: 'translateX('+(x*4)+'em)'
	}).appendTo($row);
}

function getTile(x,y){
	var $tile = getCol(y,x).find('.tile');
	if($tile.length > 0){
		return $tile;
	}
	else{
		return createTile(x,y,12);
	}
}

function createTile(x,y,tile){
	var $tile = getCol(y,x).find('.tile');
	if($tile.length == 0){
		$tile = $tileTemplate.clone();
		$tile.css('z-index',(1000+x+y)*2);
		$tile.appendTo(getCol(y,x));
	}
	$tile.find('div').removeAttr('class').addClass('tile-'+tile);

/*	if ( x % mapSize == 1 ) {
		$tile.find('div').css({
			transform: 'translateX('+(x*8)+'em)'
		})
	}*/
	return $tile;
}

function setTile(x,y,tile){
	var $tile = getTile(x,y);
	$tile.find('div').removeAttr('class').addClass('tile-'+tile);
}

function setTileHeight(x,y,height){
	var $tile = getTile(x,y);
	$tile.css({
		transform: 'translate3d('+(height)+'em, '+(height)+'em, 0em)'
	});
}

function hideTile(x,y){
	getTile(x,y).addClass('hide');
}

function showTile(x,y){
	getTile(x,y).removeClass('hide');
}

function toggleTile(x,y){
	getTile(x,y).toggleClass('hide');
}

function setSize(w,h,tile){
	for (var y = -h/2; y < h/2; y++) {
		for (var x = -w/2; x < w/2; x++) {
			createTile(x,y,tile);
		};
	};
}

function setMapPosition(x,y,animate){
	mapPossition.x = x;
	mapPossition.y = y;

	$el = $('table')
	$el[(animate)? 'animate' : 'css']({
		left: ((window.innerWidth/2) - $el.width()/2) + x,
		top: ((window.innerHeight/2) - $el.height()/2) + y
	});
}

function init(){
	//create map
	for (var y = 0; y < mapSize; y++) {
		for (var x = 0; x < mapSize; x++) {
			setTile(x-(mapSize/2),y-(mapSize/2),mapData[(y*mapSize) + x]-1)
		};
	};

	var mousePos = {};
	var mapPos = {};
	var dragging = false;
	$(document).mousedown(function(event) {
		mousePos.x = event.pageX;
		mousePos.y = event.pageY;
		mapPos.x = mapPossition.x;
		mapPos.y = mapPossition.y;
		dragging = true;
	}).mousemove(function(event) {
		if(dragging){
			setMapPosition(mapPos.x + (event.pageX - mousePos.x), mapPos.y + (event.pageY - mousePos.y));
		}
	}).mouseup(function(event) {
		dragging = false;
	});

	var func = function(){
		for (var x = 0; x < mapSize; x++) {
			for (var y = 0; y < mapSize; y++) {

				var tile = getTile(x,y);

				if(tile.hasClass('hide')){
					showTile(x,y);
				}
			}
		};
	}
	setInterval(func,100);
}

//start
init();

$(window).resize(function(event) {
	setMapPosition(0,0);
});
$(window).trigger('resize');

$('.tile').mouseover(function(event) {
	/* Act on the event */
	$(this).addClass('hide');
});